:toc:

= https://github.com/neo4j/graphql/issues/1628

== Source schema

[source,graphql,schema=true]
----
type frbr__Work @node(additionalLabels: ["Resource"]) @exclude(operations: [CREATE, UPDATE, DELETE]) {
  """IRI"""
  iri: ID! @unique @alias(property: "uri")
  dcterms__title: [dcterms_title!]! @relationship(type: "dcterms__title", direction: OUT)
}

type dcterms_title @node(additionalLabels: ["property"]) @exclude(operations: [CREATE, UPDATE, DELETE]) {
  value: String
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{}
----
== Filter generated by query doesn't utilise index

.GraphQL-Query
[source,graphql]
----
{
  frbrWorks(
    options: {limit: 10000}
    where: {dcterms__title: {value_CONTAINS: "0777"}}
  ) {
    iri
    dcterms__title(where: {value_CONTAINS: "0777"}) {
      value
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": "0777",
  "param1": {
    "low": 10000,
    "high": 0
  },
  "param2": "0777"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:`frbr__Work`:`Resource`)
WHERE EXISTS {
    MATCH (this)-[:dcterms__title]->(this0:`dcterms_title`:`property`)
    WHERE this0.value CONTAINS $param0
}

WITH *

LIMIT $param1
CALL {
    WITH this
    MATCH (this)-[this1:dcterms__title]->(this_dcterms__title:`dcterms_title`:`property`)
    WHERE this_dcterms__title.value CONTAINS $param2
    WITH this_dcterms__title { .value } AS this_dcterms__title
    RETURN collect(this_dcterms__title) AS this_dcterms__title
}
RETURN this { iri: this.uri, dcterms__title: this_dcterms__title } AS this
----

'''

