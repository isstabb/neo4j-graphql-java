:toc:

= #387

== Source schema

[source,graphql,schema=true]
----
scalar URL

type Place {
  name: String
  url_works: String @cypher(statement: """return '' + ''""")
  url_fails: URL @cypher(statement: """return '' + ''""")
  url_array_works: [String] @cypher(statement: """return ['' + '']""")
  url_array_fails: [URL] @cypher(statement: """return ['' + '']""")
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{
  "enableRegex": true
}
----
== Should project custom scalars from custom Cypher correctly

.GraphQL-Query
[source,graphql]
----
{
  places {
    url_works
    url_fails
    url_array_works
    url_array_fails
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "auth" : {
    "isAuthenticated" : false,
    "roles" : [ ]
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Place)
CALL {
	WITH this
	UNWIND apoc.cypher.runFirstColumnSingle('return \'\' + \'\'', {
		this: this,
		auth: $auth
	}) AS this_url_works
	RETURN head(collect(this_url_works)) AS this_url_works
}
CALL {
	WITH this
	UNWIND apoc.cypher.runFirstColumnSingle('return \'\' + \'\'', {
		this: this,
		auth: $auth
	}) AS this_url_fails
	RETURN head(collect(this_url_fails)) AS this_url_fails
}
CALL {
	WITH this
	UNWIND apoc.cypher.runFirstColumnSingle('return [\'\' + \'\']', {
		this: this,
		auth: $auth
	}) AS this_url_array_works
	RETURN collect(this_url_array_works) AS this_url_array_works
}
CALL {
	WITH this
	UNWIND apoc.cypher.runFirstColumnSingle('return [\'\' + \'\']', {
		this: this,
		auth: $auth
	}) AS this_url_array_fails
	RETURN collect(this_url_array_fails) AS this_url_array_fails
}
RETURN this {
	url_works: this_url_works,
	url_fails: this_url_fails,
	url_array_works: this_url_array_works,
	url_array_fails: this_url_array_fails
} AS this
----

'''

