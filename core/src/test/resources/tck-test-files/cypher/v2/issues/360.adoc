:toc:

= #360

== Source schema

[source,graphql,schema=true]
----
type Event {
  id: ID!
  name: String
  start: DateTime
  end: DateTime
  activity: String
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{
  "enableRegex": true
}
----
== Should exclude undefined members in AND

.GraphQL-Query
[source,graphql]
----
query ($rangeStart: DateTime, $rangeEnd: DateTime, $activity: String) {
  events(
    where: {AND: [{start_GTE: $rangeStart}, {start_LTE: $rangeEnd}, {activity: $activity}]}
  ) {
    start
    activity
  }
}
----

.GraphQL params input
[source,json,request=true]
----
{
  "rangeStart": "2021-07-18T00:00:00+0100",
  "rangeEnd": "2021-07-18T23:59:59+0100"
}
----

.Expected Cypher params
[source,json]
----
{
  "this_AND_start_GTE": {
    "year": 2021,
    "month": 7,
    "day": 17,
    "hour": 23,
    "minute": 0,
    "second": 0,
    "nanosecond": 0,
    "timeZoneOffsetSeconds": 0
  },
  "this_AND1_start_LTE": {
    "year": 2021,
    "month": 7,
    "day": 18,
    "hour": 22,
    "minute": 59,
    "second": 59,
    "nanosecond": 0,
    "timeZoneOffsetSeconds": 0
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Event)
WHERE (this.start >= $this_AND_start_GTE AND this.start <= $this_AND1_start_LTE)
RETURN this { start: apoc.date.convertFormat(toString(this.start), "iso_zoned_date_time", "iso_offset_date_time"), .activity } as this
----

== Should exclude undefined members in OR

.GraphQL-Query
[source,graphql]
----
query ($rangeStart: DateTime, $rangeEnd: DateTime, $activity: String) {
  events(
    where: {OR: [{start_GTE: $rangeStart}, {start_LTE: $rangeEnd}, {activity: $activity}]}
  ) {
    start
    activity
  }
}
----

.GraphQL params input
[source,json,request=true]
----
{
  "rangeStart": "2021-07-18T00:00:00+0100",
  "rangeEnd": "2021-07-18T23:59:59+0100"
}
----

.Expected Cypher params
[source,json]
----
{
  "this_OR_start_GTE": {
    "year": 2021,
    "month": 7,
    "day": 17,
    "hour": 23,
    "minute": 0,
    "second": 0,
    "nanosecond": 0,
    "timeZoneOffsetSeconds": 0
  },
  "this_OR1_start_LTE": {
    "year": 2021,
    "month": 7,
    "day": 18,
    "hour": 22,
    "minute": 59,
    "second": 59,
    "nanosecond": 0,
    "timeZoneOffsetSeconds": 0
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Event)
WHERE (this.start >= $this_OR_start_GTE OR this.start <= $this_OR1_start_LTE)
RETURN this { start: apoc.date.convertFormat(toString(this.start), "iso_zoned_date_time", "iso_offset_date_time"), .activity } as this
----

