:toc:

= https://github.com/neo4j/graphql/issues/1348

== Source schema

[source,graphql,schema=true]
----
interface Product {
  productTitle: String!
  releatsTo: [Product!]!
}

type Series implements Product {
  productTitle: String!
  releatsTo: [Product!]! @relationship(type: "RELATES_TO", direction: OUT, queryDirection: DEFAULT_UNDIRECTED)
  seasons: [Season!]!
}

type Season implements Product {
  productTitle: String!
  releatsTo: [Product!]! @relationship(type: "RELATES_TO", direction: OUT, queryDirection: DEFAULT_UNDIRECTED)
  seasonNumber: Int
  episodes: [ProgrammeItem!]!
}

type ProgrammeItem implements Product {
  productTitle: String!
  releatsTo: [Product!]! @relationship(type: "RELATES_TO", direction: OUT, queryDirection: DEFAULT_UNDIRECTED)
  episodeNumber: Int
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{}
----
== should also return node with no relationship in result set

.GraphQL-Query
[source,graphql]
----
{
  programmeItems {
    productTitle
    episodeNumber
    releatsTo {
      __typename
      productTitle
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{ }
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:ProgrammeItem)
WITH *
CALL {
	WITH *
	CALL {
		WITH this
		MATCH (this)-[this0:RELATES_TO]-(this_Series:Series)
		RETURN {
			__resolveType: 'Series',
			productTitle: this_Series.productTitle
		} AS this_releatsTo UNION
		WITH this
		MATCH (this)-[this1:RELATES_TO]-(this_Season:Season)
		RETURN {
			__resolveType: 'Season',
			productTitle: this_Season.productTitle
		} AS this_releatsTo UNION
		WITH this
		MATCH (this)-[this2:RELATES_TO]-(this_ProgrammeItem:ProgrammeItem)
		RETURN {
			__resolveType: 'ProgrammeItem',
			productTitle: this_ProgrammeItem.productTitle
		} AS this_releatsTo
	}
	RETURN collect(this_releatsTo) AS this_releatsTo
}
RETURN this {
	.productTitle,
	.episodeNumber,
	releatsTo: this_releatsTo
} AS this
----

'''

== should return node with no relationship (edge) in result set, as Relay connection

.GraphQL-Query
[source,graphql]
----
{
  programmeItems {
    productTitle
    episodeNumber
    releatsToConnection {
      edges {
        node {
          ... on ProgrammeItem {
            productTitle
          }
          ... on Season {
            productTitle
          }
          ... on Series {
            productTitle
          }
        }
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{ }
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:ProgrammeItem)
CALL {
	WITH this
	CALL {
		WITH this
		MATCH (this)-[this_connection_releatsToConnectionthis0:RELATES_TO]-(this_Series:Series)
		WITH {
			node: {
				__resolveType: 'Series',
				productTitle: this_Series.productTitle
			}
		} AS edge
		RETURN edge UNION
		WITH this
		MATCH (this)-[this_connection_releatsToConnectionthis1:RELATES_TO]-(this_Season:Season)
		WITH {
			node: {
				__resolveType: 'Season',
				productTitle: this_Season.productTitle
			}
		} AS edge
		RETURN edge UNION
		WITH this
		MATCH (this)-[this_connection_releatsToConnectionthis2:RELATES_TO]-(this_ProgrammeItem:ProgrammeItem)
		WITH {
			node: {
				__resolveType: 'ProgrammeItem',
				productTitle: this_ProgrammeItem.productTitle
			}
		} AS edge
		RETURN edge
	}
	WITH collect(edge) AS edges
	WITH edges, size(edges) AS totalCount
	RETURN {
		edges: edges,
		totalCount: totalCount
	} AS this_releatsToConnection
}
RETURN this {
	.productTitle,
	.episodeNumber,
	releatsToConnection: this_releatsToConnection
} AS this
----

'''

