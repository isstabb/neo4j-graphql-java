:toc:

= https://github.com/neo4j/graphql/issues/901

== Source schema

[source,graphql,schema=true]
----
type Series {
  id: ID! @id
  name: String!
  brand: Series @relationship(type: "HAS_BRAND", direction: OUT, properties: "Properties")
  manufacturer: Series @relationship(type: "HAS_MANUFACTURER", direction: OUT, properties: "Properties")
}

interface Properties {
  current: Boolean
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{
  "enableRegex": true
}
----
== conjuctions

.GraphQL-Query
[source,graphql]
----
query ($where: SeriesWhere) {
  series(where: $where) {
    name
    brand {
      name
    }
    manufacturer {
      name
    }
  }
}
----

.GraphQL params input
[source,json,request=true]
----
{
  "where": {
    "OR": [
      {
        "manufacturerConnection": {
          "edge": {
            "current": true
          },
          "node": {
            "name": "abc"
          }
        }
      },
      {
        "brandConnection": {
          "edge": {
            "current": true
          },
          "node": {
            "name": "smart"
          }
        }
      }
    ]
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": true,
  "param1": "abc",
  "param2": true,
  "param3": "smart"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:`Series`)
WHERE (size([(this)-[this0:HAS_MANUFACTURER]->(this1:`Series`) WHERE (this0.current = $param0 AND this1.name = $param1) | 1]) = 1 OR size([(this)-[this2:HAS_BRAND]->(this3:`Series`) WHERE (this2.current = $param2 AND this3.name = $param3) | 1]) = 1)

CALL {
    WITH this
    MATCH (this)-[this4:HAS_BRAND]->(this_brand:`Series`)
    WITH this_brand { .name } AS this_brand
    RETURN head(collect(this_brand)) AS this_brand
}
CALL {
    WITH this
    MATCH (this)-[this5:HAS_MANUFACTURER]->(this_manufacturer:`Series`)
    WITH this_manufacturer { .name } AS this_manufacturer
    RETURN head(collect(this_manufacturer)) AS this_manufacturer
}
RETURN this { .name, brand: this_brand, manufacturer: this_manufacturer } AS this
----

'''

