:toc:

= Cypher relationship

== Source schema

[source,graphql,schema=true]
----
type Actor {
  name: String
  movies: [Movie!]! @relationship(type: "ACTED_IN", direction: OUT)
}

interface MovieInterface {
  id: ID
  title: String
  actors: [Actor!]! @relationship(type: "ACTED_IN", direction: IN)
}

type Movie implements MovieInterface {
  id: ID
  title: String
  actors: [Actor!]!
  topActor: Actor! @relationship(type: "TOP_ACTOR", direction: OUT)
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{
}
----
== Many relation

.GraphQL-Query
[source,graphql]
----
{
  movies {
    title
    actors {
      name
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Movie)
RETURN this { .title, actors: [ (this)<-[:ACTED_IN]-(this_actors:Actor)   | this_actors { .name } ] } as this
----

== Nested relation

.GraphQL-Query
[source,graphql]
----
{
  movies {
    title
    topActor {
      name
      movies {
        title
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Movie)
RETURN this { .title, topActor: head([ (this)-[:TOP_ACTOR]->(this_topActor:Actor)   | this_topActor { .name, movies: [ (this_topActor)-[:ACTED_IN]->(this_topActor_movies:Movie)   | this_topActor_movies { .title } ] } ]) } as this
----

== Nested relation with params

.GraphQL-Query
[source,graphql]
----
{
  movies(where: {title: "some title"}) {
    title
    topActor(where: {name: "top actor"}) {
      name
      movies(where: {title: "top actor movie"}) {
        title
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "this_title": "some title",
  "this_topActor_movies_title": "top actor movie",
  "this_topActor_name": "top actor"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Movie)
WHERE this.title = $this_title
RETURN this { .title, topActor: head([ (this)-[:TOP_ACTOR]->(this_topActor:Actor)  WHERE this_topActor.name = $this_topActor_name | this_topActor { .name, movies: [ (this_topActor)-[:ACTED_IN]->(this_topActor_movies:Movie)  WHERE this_topActor_movies.title = $this_topActor_movies_title | this_topActor_movies { .title } ] } ]) } as this
----

== Simple relation

.GraphQL-Query
[source,graphql]
----
{
  movies {
    title
    topActor {
      name
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Movie)
RETURN this { .title, topActor: head([ (this)-[:TOP_ACTOR]->(this_topActor:Actor)   | this_topActor { .name } ]) } as this
----

