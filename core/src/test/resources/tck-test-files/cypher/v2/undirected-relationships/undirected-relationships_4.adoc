:toc:

= Undirected relationships

== Source schema

[source,graphql,schema=true]
----
type Foo {
  id: ID @unique
  Name: String
  Age: Int
  DrinksAt: Bar @relationship(type: "DRINKS_AT", direction: OUT)
}

type Bar {
  id: ID @unique
  Adress: String
  Customers: [Foo!]! @relationship(type: "DRINKS_AT", direction: IN)
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{}
----
== nested undirected relationship

.GraphQL-Query
[source,graphql]
----
query Query {
  foos {
    DrinksAt {
      id
      Customers(directed: false) {
        Name
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{ }
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Foo)
CALL {
	WITH this
	MATCH (this)-[this0:DRINKS_AT]->(this_DrinksAt:Bar)
	CALL {
		WITH this_DrinksAt
		MATCH (this_DrinksAt)-[this1:DRINKS_AT]-(this_DrinksAt_Customers:Foo)
		WITH this_DrinksAt_Customers {
			.Name
		} AS this_DrinksAt_Customers
		RETURN collect(this_DrinksAt_Customers) AS this_DrinksAt_Customers
	}
	WITH this_DrinksAt {
		.id,
		Customers: this_DrinksAt_Customers
	} AS this_DrinksAt
	RETURN head(collect(this_DrinksAt)) AS this_DrinksAt
}
RETURN this {
	DrinksAt: this_DrinksAt
} AS this
----

'''

