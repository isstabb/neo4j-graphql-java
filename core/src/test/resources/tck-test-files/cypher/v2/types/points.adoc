:toc:

= Cypher Points

== Source schema

[source,graphql,schema=true]
----
type PointContainer {
  id: String
  points: [Point]
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{
}
----
== Simple Points create mutation

.GraphQL-Query
[source,graphql]
----
mutation {
  createPointContainers(input: {points: [{longitude: 1.0, latitude: 2.0}]}) {
    pointContainers {
      points {
        longitude
        latitude
        crs
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "this0_points": [
    {
      "longitude": 1,
      "latitude": 2
    }
  ]
}
----

.Expected Cypher output
[source,cypher]
----
CALL {
CREATE (this0:PointContainer)
SET this0.points = [p in $this0_points | point(p)]
RETURN this0
}
RETURN 
this0 { points: apoc.cypher.runFirstColumn('RETURN
CASE this0.points IS NOT NULL
	WHEN true THEN [p in this0.points | { point:p, crs: p.crs }]
	ELSE NULL
END AS result',{ this0: this0 },false) } AS this0
----

== Simple Points INCLUDES query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(where: {points_INCLUDES: {longitude: 1.0, latitude: 2.0}}) {
    points {
      longitude
      latitude
      crs
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "this_points_INCLUDES": {
    "longitude": 1,
    "latitude": 2
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE point($this_points_INCLUDES) IN this.points
RETURN this { points: apoc.cypher.runFirstColumn('RETURN
CASE this.points IS NOT NULL
	WHEN true THEN [p in this.points | { point:p, crs: p.crs }]
	ELSE NULL
END AS result',{ this: this },false) } as this
----

== Simple Points NOT INCLUDES query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(where: {points_NOT_INCLUDES: {longitude: 1.0, latitude: 2.0}}) {
    points {
      longitude
      latitude
      crs
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "this_points_NOT_INCLUDES": {
    "longitude": 1,
    "latitude": 2
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE (NOT point($this_points_NOT_INCLUDES) IN this.points)
RETURN this { points: apoc.cypher.runFirstColumn('RETURN
CASE this.points IS NOT NULL
	WHEN true THEN [p in this.points | { point:p, crs: p.crs }]
	ELSE NULL
END AS result',{ this: this },false) } as this
----

== Simple Points NOT query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(where: {points_NOT: [{longitude: 1.0, latitude: 2.0}]}) {
    points {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "this_points_NOT": [
    {
      "longitude": 1,
      "latitude": 2
    }
  ]
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE (NOT this.points = [p in $this_points_NOT | point(p)])
RETURN this { points: apoc.cypher.runFirstColumn('RETURN
CASE this.points IS NOT NULL
	WHEN true THEN [p in this.points | { point:p }]
	ELSE NULL
END AS result',{ this: this },false) } as this
----

== Simple Points query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(where: {points: [{longitude: 1.0, latitude: 2.0}]}) {
    points {
      longitude
      latitude
      crs
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "this_points": [
    {
      "longitude": 1,
      "latitude": 2
    }
  ]
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE this.points = [p in $this_points | point(p)]
RETURN this { points: apoc.cypher.runFirstColumn('RETURN
CASE this.points IS NOT NULL
	WHEN true THEN [p in this.points | { point:p, crs: p.crs }]
	ELSE NULL
END AS result',{ this: this },false) } as this
----

== Simple Points update mutation

.GraphQL-Query
[source,graphql]
----
mutation {
  updatePointContainers(
    where: {id: "id"}
    update: {points: [{longitude: 1.0, latitude: 2.0}]}
  ) {
    pointContainers {
      points {
        longitude
        latitude
        crs
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "this_id": "id",
  "this_update_points": [
    {
      "longitude": 1,
      "latitude": 2
    }
  ]
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE this.id = $this_id

SET this.points = [p in $this_update_points | point(p)]

RETURN this { points: apoc.cypher.runFirstColumn('RETURN
CASE this.points IS NOT NULL
	WHEN true THEN [p in this.points | { point:p, crs: p.crs }]
	ELSE NULL
END AS result',{ this: this },false) } AS this
----

