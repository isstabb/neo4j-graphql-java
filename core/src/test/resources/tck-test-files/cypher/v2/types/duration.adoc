:toc:

= Cypher Duration

== Source schema

[source,graphql,schema=true]
----
type Movie {
  id: ID
  duration: Duration
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{
  "enableRegex": true
}
----
== GTE Read

.GraphQL-Query
[source,graphql]
----
{
  movies(where: {duration_GTE: "P3Y4M"}) {
    duration
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": {
    "months": 40,
    "days": 0,
    "seconds": {
      "low": 0,
      "high": 0
    },
    "nanoseconds": {
      "low": 0,
      "high": 0
    }
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:`Movie`)
WHERE datetime() + this.duration >= datetime() + $param0


RETURN this { .duration } AS this
----

'''

== Simple Create

.GraphQL-Query
[source,graphql]
----
mutation {
  createMovies(input: [{duration: "P2Y"}]) {
    movies {
      duration
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "create_param0": [
    {
      "duration": {
        "months": 24,
        "days": 0,
        "seconds": {
          "low": 0,
          "high": 0
        },
        "nanoseconds": {
          "low": 0,
          "high": 0
        }
      }
    }
  ],
  "resolvedCallbacks": {}
}
----

.Expected Cypher output
[source,cypher]
----
UNWIND $create_param0 AS create_var1
CALL {
    WITH create_var1
    CREATE (create_this0:`Movie`)
    SET
        create_this0.duration = create_var1.duration
    
    RETURN create_this0
}
RETURN collect(create_this0 { .duration }) AS data
----

'''

== Simple Read

.GraphQL-Query
[source,graphql]
----
{
  movies(where: {duration: "P1Y"}) {
    duration
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": {
    "months": 12,
    "days": 0,
    "seconds": {
      "low": 0,
      "high": 0
    },
    "nanoseconds": {
      "low": 0,
      "high": 0
    }
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:`Movie`)
WHERE this.duration = $param0


RETURN this { .duration } AS this
----

'''

== Simple Update

.GraphQL-Query
[source,graphql]
----
mutation {
  updateMovies(update: {duration: "P4D"}) {
    movies {
      id
      duration
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "this_update_duration": {
    "months": 0,
    "days": 4,
    "seconds": {
      "low": 0,
      "high": 0
    },
    "nanoseconds": {
      "low": 0,
      "high": 0
    }
  },
  "resolvedCallbacks": {}
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:`Movie`)


SET this.duration = $this_update_duration

RETURN collect(DISTINCT this { .id, .duration }) AS data
----

'''

