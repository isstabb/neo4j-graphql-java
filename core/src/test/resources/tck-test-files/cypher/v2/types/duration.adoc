:toc:

= Cypher Duration

== Source schema

[source,graphql,schema=true]
----
type Movie {
  id: ID
  duration: Duration
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{
  "enableRegex": true
}
----
== GTE Read

.GraphQL-Query
[source,graphql]
----
{
  movies(where: {duration_GTE: "P3Y4M"}) {
    duration
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "this_duration_GTE": {
    "months": 40,
    "days": 0,
    "seconds": {
      "low": 0,
      "high": 0
    },
    "nanoseconds": {
      "low": 0,
      "high": 0
    }
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Movie)
WHERE datetime() + this.duration >= datetime() + $this_duration_GTE
RETURN this { .duration } as this
----

'''

== Simple Create

.GraphQL-Query
[source,graphql]
----
mutation {
  createMovies(input: [{duration: "P2Y"}]) {
    movies {
      duration
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "this0_duration": {
    "months": 24,
    "days": 0,
    "seconds": {
      "low": 0,
      "high": 0
    },
    "nanoseconds": {
      "low": 0,
      "high": 0
    }
  }
}
----

.Expected Cypher output
[source,cypher]
----
CALL {
CREATE (this0:Movie)
SET this0.duration = $this0_duration
RETURN this0
}
RETURN 
this0 { .duration } AS this0
----

'''

== Simple Read

.GraphQL-Query
[source,graphql]
----
{
  movies(where: {duration: "P1Y"}) {
    duration
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "this_duration": {
    "months": 12,
    "days": 0,
    "seconds": {
      "low": 0,
      "high": 0
    },
    "nanoseconds": {
      "low": 0,
      "high": 0
    }
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Movie)
WHERE this.duration = $this_duration
RETURN this { .duration } as this
----

'''

== Simple Update

.GraphQL-Query
[source,graphql]
----
mutation {
  updateMovies(update: {duration: "P4D"}) {
    movies {
      id
      duration
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "this_update_duration": {
    "months": 0,
    "days": 4,
    "seconds": {
      "low": 0,
      "high": 0
    },
    "nanoseconds": {
      "low": 0,
      "high": 0
    }
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Movie)

SET this.duration = $this_update_duration

RETURN this { .id, .duration } AS this
----

'''

