:toc:

= Cypher pagination tests

== Source schema

[source,graphql,schema=true]
----
type Movie {
  id: ID
  title: String
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{
  "enableRegex": true
}
----
== Limit

.GraphQL-Query
[source,graphql]
----
{
  movies(options: {limit: 1}) {
    title
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": {
    "low": 1,
    "high": 0
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Movie)
WITH * LIMIT $param0
RETURN this {
	.title
} AS this
----

'''

== Skip + Limit

.GraphQL-Query
[source,graphql]
----
{
  movies(options: {limit: 1, offset: 2}) {
    title
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": {
    "low": 2,
    "high": 0
  },
  "param1": {
    "low": 1,
    "high": 0
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Movie)
WITH * SKIP $param0 LIMIT $param1
RETURN this {
	.title
} AS this
----

'''

== Skip + Limit as variables

.GraphQL-Query
[source,graphql]
----
query ($offset: Int, $limit: Int) {
  movies(options: {limit: $limit, offset: $offset}) {
    title
  }
}
----

.GraphQL params input
[source,json,request=true]
----
{
  "offset": 0,
  "limit": 0
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": {
    "low": 0,
    "high": 0
  },
  "param1": {
    "low": 0,
    "high": 0
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Movie)
WITH * SKIP $param0 LIMIT $param1
RETURN this {
	.title
} AS this
----

'''

== Skip + Limit with other variables

.GraphQL-Query
[source,graphql]
----
query ($offset: Int, $limit: Int, $title: String) {
  movies(options: {limit: $limit, offset: $offset}, where: {title: $title}) {
    title
  }
}
----

.GraphQL params input
[source,json,request=true]
----
{
  "limit": 1,
  "offset": 2,
  "title": "some title"
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": "some title",
  "param1": {
    "low": 2,
    "high": 0
  },
  "param2": {
    "low": 1,
    "high": 0
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Movie)
WHERE this.title = $param0
WITH * SKIP $param1 LIMIT $param2
RETURN this {
	.title
} AS this
----

'''

== Skipping

.GraphQL-Query
[source,graphql]
----
{
  movies(options: {offset: 1}) {
    title
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": {
    "low": 1,
    "high": 0
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Movie)
WITH * SKIP $param0
RETURN this {
	.title
} AS this
----

'''

