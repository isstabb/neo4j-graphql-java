:toc:

= Relationship Properties Create Cypher

== Source schema

[source,graphql,schema=true]
----
type Movie {
  title: String!
  actors: [Actor!]! @relationship(type: "ACTED_IN", properties: "ActedIn", direction: IN)
}

type Actor {
  name: String!
  movies: [Movie!]! @relationship(type: "ACTED_IN", properties: "ActedIn", direction: OUT)
}

interface ActedIn {
  screenTime: Int!
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{
  "enableRegex": true
}
----
== Create movie with a relationship that has properties

.GraphQL-Query
[source,graphql]
----
mutation {
  createMovies(
    input: [{title: "Forrest Gump", actors: {create: [{node: {name: "Tom Hanks"}, edge: {screenTime: 60}}]}}]
  ) {
    movies {
      title
      actorsConnection {
        edges {
          screenTime
          node {
            name
          }
        }
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "create_param0" : [ {
    "title" : "Forrest Gump",
    "actors" : {
      "create" : [ {
        "node" : {
          "name" : "Tom Hanks"
        },
        "edge" : {
          "screenTime" : 60
        }
      } ]
    }
  } ],
  "resolvedCallbacks" : { }
}
----

.Expected Cypher output
[source,cypher]
----
UNWIND $create_param0 AS create_var1
CALL {
	WITH create_var1
	CREATE (create_this0:Movie)
	SET create_this0.title = create_var1.title
	WITH create_this0, create_var1
	CALL {
		WITH create_this0, create_var1
		UNWIND create_var1.actors.create AS create_var2
		WITH create_var2.node AS create_var3, create_var2.edge AS create_var4, create_this0
		CREATE (create_this5:Actor)
		SET create_this5.name = create_var3.name
		MERGE (create_this5)-[create_this6:ACTED_IN]->(create_this0)
		SET create_this6.screenTime = create_var4.screenTime
		RETURN collect(NULL) AS create_var7
	}
	RETURN create_this0
}
CALL {
	WITH create_this0
	MATCH (create_this0)<-[create_this0_connection_actorsConnectionthis0:ACTED_IN]-(create_this0_Actor:Actor)
	WITH {
		screenTime: create_this0_connection_actorsConnectionthis0.screenTime,
		node: {
			name: create_this0_Actor.name
		}
	} AS edge
	WITH collect(edge) AS edges
	WITH edges, size(edges) AS totalCount
	RETURN {
		edges: edges,
		totalCount: totalCount
	} AS create_this0_actorsConnection
}
RETURN collect(create_this0 {
	.title,
	actorsConnection: create_this0_actorsConnection
}) AS data
----

'''

